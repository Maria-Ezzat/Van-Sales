<div class="card shadow-sm border-0 rounded-4 p-3 warehouse-details-card">
 <div class="card-header bg-transparent border-bottom-0 pb-0 d-flex justify-content-between align-items-start">
  <div>
    <h3 class="mb-0">{{ warehouse.name }}</h3>
    <small class="text-muted">Code: {{ warehouse.code }}</small>
  </div>
  <button class="bg-purple-100 py-2 px-4 color-purple-500 no-border cr3" (click)="showCartDialog($event)"
    >Add Product</button>
</div>

  <div class="card-body">
    <div class="row">
      <div class="col-md-6 mb-3"><strong>Data:</strong> {{ warehouse.data }}</div>
      <div class="col-md-6 mb-3"><strong>Type:</strong> {{ getWarehouseTypeName(warehouse.warehouseType) }}</div>

      <div class="col-md-6 mb-3"><strong>Governorate:</strong> {{ warehouse.governorateName }}</div>
      <div class="col-md-6 mb-3"><strong>City:</strong> {{ warehouse.cityName }}</div>

      <div class="col-md-6 mb-3"><strong>Street:</strong> {{ warehouse.street }}</div>
      <div class="col-md-6 mb-3"><strong>Landmark:</strong> {{ warehouse.landmark }}</div>

      <div class="col-md-6 mb-3"><strong>Building Data:</strong> {{ warehouse.buildingData }}</div>
      <div class="col-md-6 mb-3"><strong>Coordinates:</strong> {{ warehouse.latitude }}, {{ warehouse.longitude }}</div>
    </div>

    <!-- Products Section -->
    <div class="mt-4">
      <h5 class="mb-3">Products in Warehouse</h5>
      <div class="row">
        <div class="col-md-4 col-sm-6 mb-4" *ngFor="let product of warehouse.warehouseProducts">
          <div class="card h-100 border rounded-4 shadow-sm product-card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="product-icon bg-primary text-white rounded-circle d-flex justify-content-center align-items-center me-3">
                  <i class="pi pi-box" style="font-size: 1.2rem;"></i>
                </div>
                <div>
                  <div class="text-muted small">Product</div>
                  <div class="fw-bold">{{ product.productName }}</div>
                </div>
              </div>

              <div class="text-end mt-auto">
                <span class="badge bg-secondary">Quantity: {{ product.quantity }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12" *ngIf="!warehouse.warehouseProducts?.length">
          <div class="alert alert-secondary text-center">
            No products found
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="sidebar" [class.open]="cartVisible">
  <div class="sidebar-header d-flex justify-content-between align-items-center">
    <h4>Add Product</h4>
    <button class="btn-close" (click)="closeCartDialog()">&times;</button>
  </div>

  <div class="sidebar-body p-3">
    <div class="transfer-process d-flex align-items-center mb-3">
      <img src="../assets/images/addOrder.png" alt="Transfer Process Icon" class="me-2"
           style="width: 30px; height: 30px;" />
      <p class="mb-0 fw-bold">Product Process</p>
    </div>

    <!-- Dropdown لاختيار المنتج -->
    <div class="row p-2" style="font-size: 12px;">
      <p class="form-label">
       Product <span class="text-danger">*</span>
      </p>

      <ng-control
        [type]="controlType.SELECT"
        [form]="productForm"
        control="selectedProduct"
        placeholder="sites.transfer.product"
        [items]="products"
        (change)="onProductSelected($event)">
      </ng-control>
    </div>

    <!-- جدول المنتجات المختارة -->
    <table class="table table-bordered mt-4">
      <thead>
        <tr>
          <th>{{ "sites.request.product" | translate }}</th>
          <th>{{ "sites.request.quantity" | translate }}</th>
          <th class="text-center">{{ "sites.request.action" | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of cartItems; let i = index">
          <td>{{ item.productName }}</td>
          <td class="d-flex align-items-center gap-2">
            <button pButton icon="pi pi-minus" class="p-button-sm p-button-text p-button-secondary" (click)="decreaseQuantity(i)"></button>
            {{ item.quantity }}
            <button pButton icon="pi pi-plus" class="p-button-sm p-button-text p-button-secondary" (click)="increaseQuantity(i)"></button>
          </td>
          <td class="text-center">
            <button pButton icon="pi pi-trash"
                            class="p-button-rounded p-button-text p-button-danger p-0 pointer" aria-label="Delete" (click)="removeProduct(i)"></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="sidebar-footer d-flex justify-content-end gap-2 mt-4">
    <button class="btn btn-outline-secondary" (click)="closeCartDialog()">
      {{ "sites.request.cancel" | translate }}
    </button>
    <button pButton type="button" class="bg-purple-500 py-2 px-4 text-white border-0 rounded"
            [disabled]="pageCreate.form?.invalid || pageCreate.isSaving || cartItems.length === 0"
            (click)="saveRequest()">
      {{ "sites.request.save" | translate }}
    </button>
  </div>
</div>

<!-- Overlay -->
<div class="overlay" *ngIf="cartVisible" (click)="closeCartDialog()"></div>